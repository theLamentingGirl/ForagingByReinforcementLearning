#%%
import numpy as np
import scipy
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns
import statsmodels.api as sm
from statsmodels.formula.api import ols

"""
To check whether exploration or exploitation lead to higher rewards 
If the next value is same as the previous one, add +1 to exploitation. If the patch is changed, then +1 to exploration. 
Plot exploration/exploitation and total reward. There will be 13 datapoints and done for all 3 blocks.
"""

p1 = pd.read_csv('data/1.csv',skiprows=75)
p2 = pd.read_csv('data/2.csv',skiprows=75)
p3 = pd.read_csv('data/3.csv',skiprows=75)
p4 = pd.read_csv('data/4.csv',skiprows=75)
p5 = pd.read_csv('data/5.csv',skiprows=75)
p6 = pd.read_csv('data/6.csv',skiprows=75)
p7 = pd.read_csv('data/7.csv',skiprows=75)
p8 = pd.read_csv('data/8.csv',skiprows=75)
p9 = pd.read_csv('data/9.csv',skiprows=75)
p10 = pd.read_csv('data/10.csv',skiprows=75)
p11 = pd.read_csv('data/11.csv',skiprows=75)
p12 = pd.read_csv('data/12.csv',skiprows=75)
p13 = pd.read_csv('data/13.csv',skiprows=75)

tot_rwrd = pd.read_csv('data/total_rewards.csv',header=0,usecols=[1,2,3])
# print(tot_rwrd)

# print(p1.iloc[:,0])
person = {1:p1,2:p2,3:p3,4:p4,5:p5,6:p6,7:p7,8:p8,9:p9,10:p10,11:p11,12:p12,13:p13}
explored = 0
exploited = 0

data = pd.DataFrame(columns=["ratio","reward"])

# print(data)
# print(tot_rwrd.iloc[0].sum())
# data = data.append({"ratio":10,"reward":tot_rwrd.iloc[0].sum()},ignore_index=True)
# print(data)

for p in range(1,13):
    for i in range(1,len(person[p].iloc[:,0])):
        # print(person[p])
        if person[p].iloc[i,0] == person[p].iloc[i-1,0]:
            exploited = exploited + 1
        else:
            explored = explored + 1
        i=i+1
    ratio = explored/exploited

    data = data.append({"ratio":ratio,"reward":tot_rwrd.iloc[p].sum()},ignore_index=True)

    p=p+1
    #reset
    explored = 0
    exploited = 0

# print(data)
# data.to_csv("explore_exploit_ratio.csv")


sns.regplot(x="ratio",y="reward",data=data,fit_reg=True)






# %%
